"use strict";const{execSync:e}=require("child_process"),t=process.argv.some((e=>e.includes("vite")))||void 0!==process.env.VITE_,n=(e="")=>{const t=new Date(e||Date.now()),[n,r,s,o,i]=[t.getFullYear(),t.getMonth()+1,t.getDate(),t.getHours(),t.getMinutes()];return`${n}-${r}-${s} ${o}:${i}`},r=t=>{try{return e(t)?.toString().trim()}catch{return"--"}};function s(e={}){try{const s=((e={})=>{const t={name:"info",immediate:!1,preset:!0,consoleList:[],...e},s=(e="")=>{if(!e)return"";let t="";for(let n=0;n<e.length;n++)t+=e.charCodeAt(n)+",";return t};return`(function(window){\n  function decode(str = ""){\n    if(!str) return ""\n    let arr = str.split(",");\n    let r = "";\n    for (let i = 0; i < arr.length; i++){\n      r += String.fromCharCode(parseInt(arr[i]));\n    }\n    return r;\n  }\n  function log (description, value) {\n    console.log(\n      \`%c \${decode(description)} %c \${decode(value)} \`,\n      "background:#ff4d4f;border:1px solid #ff4d4f; padding: 1px; border-radius: 2px 0 0 2px; color: #fff",\n      "border:1px solid #ff4d4f; padding: 1px; border-radius: 0 2px 2px 0; color: #ff4d4f",\n    )\n  }\n\n  const BUILD_INFO_CONSOLE_LIST = ${(()=>{const e=Array.isArray(t.consoleList)?t.consoleList.filter((e=>e?.description)):[],o=e.map((e=>e.description)),i=[{description:"提交人员",value:r("git show -s --format=%cn")},{description:"版本信息",value:r("git show -s --format=%h")},{description:"代码分支",value:r("git symbolic-ref --short -q HEAD")},{description:"提交说明",value:r("git show -s --format=%s")},{description:"提交时间",value:n(r("git show -s --format=%cd"))}].filter((e=>!o.includes(e.description))),c=t.preset?[...i,...e]:e.length?e:[{description:"异常提示",value:"无可输出的信息！请检查配置或将preset设置为true"}];return JSON.stringify(c.map((({description:e,value:t})=>({description:s(e),value:s(t||"")}))))})()} || []\n\n  if(${t.immediate}){\n    BUILD_INFO_CONSOLE_LIST.forEach(res=>{\n      log (res.description, res.value) \n    })\n  }\n  Object.defineProperty(window, '${t.name}', {\n    get: function() {\n      console.clear();\n      BUILD_INFO_CONSOLE_LIST.forEach(res=>{\n        log (res.description, res.value) \n      })\n    }\n  })\n})(window)`})(e);return t?function(e){return{name:"vite-plugin-dist-info",transformIndexHtml(t){const n=`<script>${e}<\/script>`;return t.replace(/<\/body>/,`${n}</body>`)}}}(s):function(e){const t=e=>({source:()=>e,size:()=>e.length});return{apply(n){n.hooks.emit.tap("distInfoPlugin",(r=>{const s=Object.keys(r.assets).find((e=>e.endsWith(".js"))),o=Object.keys(r.assets).find((e=>e.endsWith(".html")));if(!s||!o)return;const i=s.split("/"),c=Date.now().toString();i[i.length-1]=`dist-info-${c}.js`;const d=i.join("/"),a=r.assets[o]?.source();if(!a)return;const l=a.replace(/(<head[^>]*>)/,`$1<script src="${n.options.output.publicPath}${d}"><\/script>`);r.assets[o]=t(l),r.assets[d]=t(e)}))}}}(s)}catch(e){console.log("DistInfoPlugin",e)}}module.exports=s,module.exports.default=s;
